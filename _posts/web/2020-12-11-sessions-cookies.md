---
layout: post
title: "Cookie · Session 기술의 이해"
category: [web]
tags: [web, cookie, session]
comments: true
---

## Cookie와 Session을 사용하는 이유

HTTP Protocol은 비연결성 (Connectionless)과 비상태성 (Stateless) 특징을 가지고 있다. 이 특징으로 인해 사용자가 요청할 때 마다 연결과 해제의 과정을 거치기 때문에 연결 상태를 유지하지 않고, 연결을 해지한 후에 상태 정보도 저장하지 않아 서버의 자원을 절약할 수 있다.

하지만 이러한 특징으로 인해 사용자를 식별할 수 없어, 같은 사용자가 여러번 요청하더라도 매번 새로운 사용자로 인식한다는 단점이 존재하며, 이를 보완하기 위해 Cookie (이하 쿠키)와 Session (이하 세션)을 사용한다.

## Cookies

쿠키는 사용자의 웹 브라우저에 저장되는 데이터로 `key - value` 형태의 String으로 이루어지며, 서버를 대신해서 어떠한 정보 (로그인 정보 등)를 웹 브라우저에 저장하고, 사용자가 요청할 때 저장된 정보를 함께 보내 서버에서 사용자를 식별할 수 있게 해준다.

웹 브라우저에 저장할 수 있는 쿠키 용량은 4KB 이하이며, 브라우저마다 저장되는 쿠키가 다르기 때문에, 브라우저가 다른 경우 다른 사용자로 인식된다. (크롬에서 남긴 쿠키를 사파리에서 사용할 수 없음)

쿠키는 주로 다음 세 가지 목적을 위해 사용된다.

- 세션 관리 (Session Management)
  - 로그인
  - 사용자 닉네임
  - 접속 시간
  - 장바구니 등
- 개인화 (Personalization)
  - 유료 회원 / 무료 회원
  - 개인 프로필, 대쉬보드
  - 기타 사용자마다 다른 페이지
- 트래킹 (Tracking)
  - 사용자의 행동과 패턴을 분석하고 기록

쿠키를 사용하면 페이지를 이동할 때마다 로그인을 하지 않고 사용자 정보를 유지할 수 있어 다음과 같은 기능에 활용할 수 있다.

- ID 저장
- 로그인 상태 유지
- 7일간 다시 보지 않기
- 최근 검색한 상품들을 광고에서 추천
- 쇼핑몰 장바구니 기능

## Sessions

세션은 비밀번호와 같은 인증 정보를 쿠키에 직접 저장하지 않고, 사용자의 식별자인 `JSESSIONID(session id)`를 저장하며, 서버에는 인증 정보와 로그인 상태, 마지막 로그인 시간, 닉네임 등의 정보를 저장한다.

> 쿠키에 직접 아이디와 비밀번호를 저장하는 것은 보안상 큰 문제를 야기한다. 따라서 직접 쿠키에 비밀번호를 저장하는 것이 아닌 세션을 통해 인증하는 방식을 사용한다.

세션 아이디는 브라우저 단위로 저장되며, 브라우저가 종료될 때 소멸된다. 또 로그인한 사용자에 대해서만 세션을 생성하는 것이 아니라, 로그아웃하면 새로운 사용자로 인식해 새로운 세션을 생성한다.

이러한 세션을 사용하는 방식은 사용자가 로그인 여부나 닉네임 등을 세션에 담아두어 사용자가 요청할 때마다 매번 사용자 데이터베이스에 접근할 필요가 없기 때문에 매우 효율적이다.

### 동작 순서

1. 클라이언트가 서버에 처음으로 Request 보냄
2. 서버에서 `session id` 쿠키 값이 없는 것을 확인하고 새로 발급해서 응답
3. 클라이언트는 전달받은 값을 매 요청마다 헤더 쿠키에 넣어서 요청
4. 서버는 `session id`를 확인하여 사용자를 식별
5. 클라이언트가 로그인을 요청하면 서버는 세션을 로그인한 사용자 정보로 갱신하고 새로운 `session id`를 발급하여 응답
6. 클라이언트는 로그인 사용자의 `session id` 쿠키를 요청과 함께 전달하고 서버에서도 로그인된 사용자로 식별할 수 있음
7. 클라이언트 종료 (브라우저 종료)시 `session id` 제거, 서버에서도 세션 제거
